services:
  # Backend API Service
  - type: web
    name: community-events-api
    runtime: docker
    dockerfilePath: ./Dockerfile.api
    plan: starter
    region: oregon
    branch: main
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: JWT_SECRET
        value: community-event-board-super-secret-jwt-key-prakhar271-production-2024
      - key: DATABASE_URL
        fromDatabase:
          name: community-events-db
          property: connectionString
      - key: REDIS_URL
        fromDatabase:
          name: community-events-redis
          property: connectionString
      - key: PLATFORM_FEE_PERCENTAGE
        value: "5"
      - key: FREE_PLAN_MAX_EVENTS
        value: "3"
      - key: FREE_PLAN_MAX_ATTENDEES
        value: "50"
      - key: PREMIUM_PLAN_PRICE
        value: "29900"
      - key: PRO_PLAN_PRICE
        value: "59900"
      - key: UPLOAD_DIR
        value: uploads
      - key: MAX_FILE_SIZE
        value: "5242880"
      - key: ALLOWED_IMAGE_TYPES
        value: image/jpeg,image/png,image/webp
      - key: BCRYPT_ROUNDS
        value: "12"
      - key: RATE_LIMIT_WINDOW_MS
        value: "900000"
      - key: RATE_LIMIT_MAX_REQUESTS
        value: "100"

  # Frontend Static Site
  - type: static
    name: community-events-frontend
    buildCommand: cd src/client && npm ci && npm run build
    staticPublishPath: src/client/dist
    branch: main
    envVars:
      - key: VITE_API_BASE_URL
        value: https://community-events-api.onrender.com/api

databases:
  # PostgreSQL Database
  - name: community-events-db
    databaseName: community_events
    plan: free

  # Redis Cache
  - name: community-events-redis
    plan: free